/*************************************************************************************************************************************

Programa em C similar ao executável host do linux. Implementação utilizando o getaddrinfo para realizar uma query DNS para recuperar
o IPv4 e utilizando o getnameinfo para converter a estrutura de endereço para o formato de ip xx.xx.xx.xx.

**************************************************************************************************************************************/

#include <stdio.h>
#include <stdlib.h>
#include <netdb.h>
#include <string.h>

int main(int argc, char* argv[]) {

	if (argc < 2) {

		fprintf(stderr,"USAGE: %s hostname\n", argv[0]);
		exit(EXIT_FAILURE);
	}

	struct addrinfo hints, *result, *rp;

	memset(&hints, 0, sizeof(struct addrinfo));

	hints.ai_family = AF_INET; //IPv4 Only

	int errorCode = getaddrinfo(argv[1], NULL, &hints, &result);

	if (errorCode != 0) {
		fprintf(stderr, "ERROR: %s\n", gai_strerror(errorCode));
		exit(EXIT_FAILURE);
	}

	char host[256];

	for(rp = result; rp != NULL; rp = rp->ai_next) {

		getnameinfo(rp->ai_addr, rp->ai_addrlen, host, sizeof(host), NULL, 0, NI_NUMERICHOST);
		fprintf(stdout, "IP: %s\nPROTOCOL: %u\n", host, rp->ai_protocol);

	}


	freeaddrinfo(result);


	return 0;

}
